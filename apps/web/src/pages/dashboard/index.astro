<main>
  <h1>Dashboard</h1>
  <h2>Create new URL and language</h2>

  <form id="url-form">
    <input type="text" name="url" placeholder="URL" required />
    <input type="text" name="language" placeholder="Language (en, fr)" required />
    <button type="submit">Create</button>
  </form>

  <h2>List of all the URLs:</h2>
  <ul id="url-list"></ul>
</main>

<style>
  body { font-family: sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
  form { display: flex; gap: 10px; margin-bottom: 2rem; }
  input { padding: 8px; flex-grow: 1; }
  
  #url-list { list-style: none; padding: 0; }
  .url-item { 
    display: flex; 
    justify-content: space-between; 
    align-items: center;
    padding: 10px; 
    border-bottom: 1px solid #ccc; 
  }
  .url-info { display: flex; gap: 15px; }
  .lang-tag { 
    background: #eee; 
    padding: 2px 6px; 
    border-radius: 4px; 
    font-size: 0.9em; 
    font-weight: bold;
  }
  .delete-btn {
    background: #ff4444;
    color: white;
    border: none;
    padding: 5px 10px;
    cursor: pointer;
    border-radius: 4px;
  }
  .delete-btn:hover { background: #cc0000; }
</style>

<script type="module">
  const form = document.getElementById('url-form')
  const list = document.getElementById('url-list')

  async function deleteUrl(id) {
    if (!confirm('Are you sure you want to delete this?')) return

    try {
      const res = await fetch(`/api/urls/${id}`, { 
        method: 'DELETE' 
      })

      if (!res.ok) throw new Error('Failed to delete')
      
      loadUrls()
    } catch (err) {
      alert(err.message)
    }
  }

  async function loadUrls() {
    list.innerHTML = 'Loading...'
    try {
      const res = await fetch('/api/urls')
      const data = await res.json()
      
      list.innerHTML = '' 

      if (data.length === 0) {
        list.innerHTML = '<li>No URLs found.</li>'
        return
      }

      data.forEach((item, i) => {
        const li = document.createElement('li')
        li.className = 'url-item'
        
        const info = document.createElement('div')
        info.className = 'url-info'
        info.innerHTML = `
      ${i + 1} - 
          <span class="lang-tag">${item.language}</span>
          <span>${item.url}</span>
        `

        const btn = document.createElement('button')
        btn.className = 'delete-btn'
        btn.textContent = 'Delete'
        btn.onclick = () => deleteUrl(item.id)

        li.appendChild(info)
        li.appendChild(btn)
        list.appendChild(li)
      })

    } catch (err) {
      list.textContent = 'Error loading data'
    }
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault() 

    try {
      const body = Object.fromEntries(new FormData(form))

      const res = await fetch('/api/urls', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body),
      })

      if (!res.ok) {
        const data = await res.json()
        throw new Error(data.error || 'Failed to create')
      }

      form.reset() 
      loadUrls()
    } catch (err) {
      alert(err.message || 'Network error')
    }
  })

  loadUrls()
</script>